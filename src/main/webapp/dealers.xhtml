<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/xhtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h = "http://java.sun.com/jsf/html"
      xmlns:f = "http://java.sun.com/jsf/core"
      xmlns:p = "http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <h:head>
        <title>TODO supply a title</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </h:head>
    <h:body>
        <div class="card">
            <p:tabMenu activeIndex="#{param.i}">
                <p:menuitem value="Home" outcome="/cardealership/homepage.xhtml" icon="pi pi-fw pi-home">
                    <f:param name="i" value="0"/>
                </p:menuitem>
                <p:menuitem value="Dealers" outcome="/cardealership/dealers.xhtml" icon="pi pi-fw pi-calendar">
                    <f:param name="i" value="1"/>
                </p:menuitem>
                <p:menuitem value="Regions" outcome="/cardealership/regions.xhtml" icon="pi pi-fw pi-pencil">
                    <f:param name="i" value="2"/>
                </p:menuitem>
            </p:tabMenu>
        </div>

        <p:dataTable id="dataTable" value="#{data.users}" var="user">
            <p:column headerText="Email">
                <h:outputText value="#{user.email}" />
            </p:column>
            <p:column headerText="Name">
                <h:outputText value="#{user.name}" />
            </p:column>
            <p:column headerText="Password">
                <h:outputText value="#{user.password}" />
            </p:column>
            <p:column headerText="">
                <f:param name="id" value="#{user.email}" />
                <a href="/delete?id=#{user.email}">delete</a>
                <!--                    <p:commandButton value="delete" action="" 
                                                     update="dataTable">
                                        <f:param name="id" value="#{user.email}" />
                                    </p:commandButton>-->
            </p:column>
        </p:dataTable><br/>

        <h:form>
            <f:param name="query" value="#{param.query}"/>
            <input name="query" value="#{param.query}"/>
            <p:commandButton value="Search" action="#{data.fullTextSearch}"
                             update="dataTable"/>
        </h:form><br/>

        <h:form>
            <p:commandButton value="Add" 
                             onclick ="toggle('#{requestScope.register.clientId}');  return false;"
                             />
        </h:form>
        <noscript>
            <style type="text/css">
                form {
                    display:block;
                }
            </style>
        </noscript>
        <script type="text/javascript">
            function toggle(id) {
                var element = document.getElementById(id);
                if (element.style.display === 'block') {
                    element.style.display = 'none';
                } else {
                    element.style.display = 'block';
                }
            }
        </script>

        <h:form binding='#{requestScope.register}' style="display: none">
            <p:panelGrid columns="2">
                <label for="email2">Email</label><br/>
                <h:inputText id="email2" value="#{data.email}"
                             validatorMessage="Email format required"
                             required="true" 
                             requiredMessage="Email left empty">
                    <f:validateRegex pattern="^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$"
                                     for="email2"/>
                </h:inputText><br/>

                <label for="name">Name</label><br/>
                <h:inputText id="name" value="#{data.name}"
                             required="true" 
                             requiredMessage="Name left empty">
                </h:inputText><br/>

                <label for="driversl">Drivers license</label><br/>
                <h:selectBooleanCheckbox id="driversl" 
                                         value="#{data.driverslicense}"/><br/>

                <label for="password">Password</label><br/>
                <h:inputSecret id="password2" value="#{data.password}"
                               validatorMessage="Password be 8 character with digit(s) and capital letter(s)"
                               required="true" 
                               requiredMessage="Password left empty">
                    <f:validateRegex pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$"
                                     for="password2"/>
                </h:inputSecret><br/>

                <label for="isAdminCheck">Assign role: </label>
                <h:selectOneListbox id="role" required="true"
                                    requiredMessage="Role must be assigned"
                                    value="#{data.role}">
                    <f:selectItems value="#{data.roles}" var="role" 
                                   itemLabel="#{role.roleName}" 
                                   itemValue="#{role.id}"/>
                </h:selectOneListbox>
            </p:panelGrid><br/>

            <p:commandButton value="Register" action="#{data.addUser}"
                             process="@form" 
                             update="@(.ui-message) dataTable"/>
            <p:message for='email2'/>
            <p:message for='name'/>
            <p:message for="password2"/>
            <p:message for="role"/>
        </h:form>
        <!--</c:if>-->
    </h:body>
</html>

